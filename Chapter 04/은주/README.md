# Chapter 04. 불변성
- 함수형 접근 방식에서는 `불변성` 이 데이터를 처리하는 주요 방법이며 다양한 개념의 전제조건이다

## 4.1. 객체 지향 프로그래밍의 가변성과 자료 구조
- 객체 지향 언어인 자바에서는 **객체의 상태를 가변 형태로 캡슐화**한다
- 객체 지향 자바 코드에서 가변 상태를 다루는 가장 일반적인 형태로는 JavaBean, POJO 가 있다
  - 컴포넌트 간의 **재사용성을 향상**시키기 위해 상태값을 캡슐화하도록 설계된 일반적인 자바 객체들이다
- POJO는 설계에 대해 어떠한 제한도 없다.
  - POJO : Plain Old Java Object / 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트
  - 비즈니스 로직 상태를 **'단지' 캡슐화 하는 것이 목적**이다
  - 가변 상태를 가진 객체지향적인 컨텍스트에서 더 유연하게 작동하도록 필드에 getter/setter 를 제공한다
- 반면 JavaBean 은 내부 검사와 재사용성을 가능하게 해주며, 이를 위해 특정 규칙을 따르도록 되어 있다

| | POJO | JavaBean |
|---|------|---|
| 일반 제한 |자바 규칙에 따름|JavaBean API 사양에 따름|
| 직렬화 |선택적|java.io.Serializable 상속해야함|
| 필드 가시성 |제한 없음|private 만 가능|
| 필드 접근 |제한 없음|getter, setter 를 통해서만 접근 가능|
| 생성자 |제한 없음|인수가 없는 생성자가 존재해야 함|

- 가변 상태는 **복잡성과 불확실성을 유발**한다
  - 가변 상태를 공유하는 것은 공유된 상태에 액세스하는 컴포넌트의 수명을 포함하여 복잡성을 증가시킨다
  - 특시 동시성 프로그래밍은 공유된 상태의 복잡성에 영향을 받고, 많은 문제가 가변성에서 발생한다

## 4.2. 함수형 프로그래밍의 불변성
- 불변성의 기본 원칙은 단순하다
  - **자료 구조는 생성 후에 변경할 수 없어야 한다**
  - 이 원칙은 함수형 프로그래밍 언어에서 기본으로 지원한다
- 불변 자료 구조는 데이터에 대한 지속적인 뷰를 제공하지만 직접 데이터를 변경할 수는 없다
- 자료구조를 변경하려면 **의도한 변경사항을 반영한 새로운 복사본을 생성해야 한다**
- 데이터를 직접 변경할 수 없으며 오버헤드를 발생시킨다는 점이 이상할 수 있지만, 불변성은 함수형 접근 방식을 넘어 자바에서는 충분한 가치가 있다
- **예측 가능성**
  - 자료구조를 참조하는 한, 생성된 시점과 `동일한` 상태임을 알 수 있다
- **유효성**
  - 초기화한 후, 자료 구조는 `완전한` 상태가 된다
  - 단, 한번의 검증만 필요하며 유효 상태로 유지된다
- **숨겨진 사이드 이펙트 없음**
  - 불변 자료 구조는 항상 그대로이기 때문에, 사이드 이펙트가 발생하지 않는다
- **스레드 안전성**
  - 사이드 이펙트가 발생하지 않는 불변 자료 구조는 `스레드 경계를 자유롭게 이동`할 수 있다
  - 프로그램에 대한 추론이 보다 간단해지며, 예기치 않은 변경 또는 경합조건 없이 프로그램을 이해할 수 있다
- **캐시 가능성 및 최적화**
  - 자료구조 생성 직후부터 변경되지 않기에 불변 자료 구조를 신뢰하고 `캐싱`할 수 있다
  - **메모이제이션과 같은 최적화 기술은 불변 자료구조에서만 가능하다**
- **변경 추적**
  - 모든 변경이 새로운 자료구조를 생성한다면, 이전 참조를 저장함으로써 이전 상태를 `추적`할 수 있다
- 이 모든 이점은 **선택한 프로그래밍 패러다임과는 독립적이다**